# üßπ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ (Docker)

## ‚ö†Ô∏è –û—à–∏–±–∫–∞: "no space left on device"

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–≥–¥–∞ –¥–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω Docker –æ–±—Ä–∞–∑–∞–º–∏, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ volumes.

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.prod.yml down

# 2. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker —Ä–µ—Å—É—Ä—Å—ã (–æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–µ—Ç–∏, volumes)
docker system prune -a --volumes -f

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
df -h
```

---

## üìä –ü–æ—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker
docker system df

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
docker system df -v
```

### –®–∞–≥ 2: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
docker compose -f docker-compose.prod.yml down

# –ò–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker stop $(docker ps -aq)
```

### –®–∞–≥ 3: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
# –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker container prune -f

# –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
docker rm -f $(docker ps -aq)
```

### –®–∞–≥ 4: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤

```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a -f

# –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã –∫—Ä–æ–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö
docker images | grep -v "REPOSITORY" | awk '{print $3}' | xargs docker rmi -f
```

### –®–∞–≥ 5: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö volumes

```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes (–û–°–¢–û–†–û–ñ–ù–û - –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î!)
docker volume prune -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volumes –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
docker volume ls
```

### –®–∞–≥ 6: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ç–µ–π

```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏
docker network prune -f
```

### –®–∞–≥ 7: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
# –£–¥–∞–ª–∏—Ç—å –í–°–Å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ (–æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–µ—Ç–∏, volumes, build cache)
docker system prune -a --volumes -f
```

---

## üéØ –¶–µ–ª–µ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—á–∏—Å—Ç–∫–∞ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è volumes (–ë–î —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.prod.yml down

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–ë–ï–ó volumes)
docker system prune -a -f

# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ build cache
docker builder prune -a -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
docker system df
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã

```bash
# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
docker image prune -a --filter "until=24h" -f

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã –±–µ–∑ —Ç–µ–≥–æ–≤ (dangling)
docker image prune -f
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ build cache

```bash
# –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å build cache
docker builder prune -a -f

# –£–¥–∞–ª–∏—Ç—å build cache —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
docker builder prune --filter "until=24h" -f
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–æ–º
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö volumes
docker volume ls

# –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ volume
docker system df -v | grep -A 10 "VOLUME NAME"
```

---

## ‚ö° –ö–æ–º–∞–Ω–¥–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)

```bash
# –û–°–¢–û–†–û–ñ–ù–û: –£–¥–∞–ª–∏—Ç –í–°–Å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ, –≤–∫–ª—é—á–∞—è volumes!
docker compose -f docker-compose.prod.yml down && docker system prune -a --volumes -f && docker builder prune -a -f && df -h
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.prod.yml down

# 2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–ë–ï–ó volumes)
docker system prune -a -f

# 3. –£–¥–∞–ª–∏—Ç—å build cache
docker builder prune -a -f

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
df -h
docker system df

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (volumes –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
docker compose -f docker-compose.prod.yml up -d
```

---

## üì¶ –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—Ä–∞–∑

```bash
docker rmi <image_id>
```

### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker rm <container_id>
```

### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π volume (–û–°–¢–û–†–û–ñ–ù–û!)

```bash
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
docker volume inspect <volume_name>

# –ó–∞—Ç–µ–º —É–¥–∞–ª–∏—Ç—å
docker volume rm <volume_name>
```

---

## üîÑ –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ - –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker compose -f docker-compose.prod.yml build --no-cache backend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.prod.yml up -d

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose -f docker-compose.prod.yml exec backend alembic upgrade head
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ –ø–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
du -sh /var/lib/docker/* | sort -h

# –¢–æ–ø 10 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
du -sh /var/lib/docker/* | sort -h | tail -10

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker
docker system df
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **`docker system prune -a --volumes`** - —É–¥–∞–ª–∏—Ç –í–°–Å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ, –≤–∫–ª—é—á–∞—è volumes —Å –¥–∞–Ω–Ω—ã–º–∏ –ë–î!
2. **`docker volume prune`** - —É–¥–∞–ª–∏—Ç –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes (–º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î!)
3. –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π:
   ```bash
   docker compose -f docker-compose.prod.yml exec postgres pg_dump -U assistadmin_pg assistance_kz > backup_$(date +%Y%m%d_%H%M%S).sql
   ```

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h
docker system df

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.prod.yml down

# 3. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–ë–ï–ó volumes)
docker system prune -a -f
docker builder prune -a -f

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
df -h
docker system df

# 5. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker-compose.prod.yml build --no-cache backend
docker compose -f docker-compose.prod.yml up -d
docker compose -f docker-compose.prod.yml exec backend alembic upgrade head
```

