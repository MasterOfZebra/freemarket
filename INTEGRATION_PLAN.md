# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Permanent/Temporary Exchange –≤ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:
1. **Backend:**
   - `ExchangeType` enum (PERMANENT/TEMPORARY)
   - `/api/listings/create-by-categories` endpoint —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π exchange_type
   - `/api/listings/find-matches/{user_id}` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ exchange_type
   - Matching –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –ø–æ —Ç–∏–ø–∞–º –æ–±–º–µ–Ω–∞
   - –ú–æ–¥–µ–ª—å `User` —Å –ø–æ–ª—è–º–∏: username, telegram_id, locations

2. **Frontend:**
   - `ExchangeTabs.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –¥–≤—É–º—è –≤–∫–ª–∞–¥–∫–∞–º–∏
   - `PermanentTab.tsx` - —Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞
   - `TemporaryTab.tsx` - —Ñ–æ—Ä–º–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞
   - `PERMANENT_CATEGORIES` –∏ `TEMPORARY_CATEGORIES` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
   - `apiService.createListing()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint

### ‚ùå –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. **App.jsx** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π `RegistrationForm` –≤–º–µ—Å—Ç–æ `ExchangeTabs`
2. **ExchangeTabs** –Ω–µ –∏–º–µ–µ—Ç —Ñ–æ—Ä–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–§–ò–û, —Ç–µ–ª–µ–≥—Ä–∞–º, –≥–æ—Ä–æ–¥)
3. **PermanentTab/TemporaryTab** –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **RegistrationForm.jsx** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ exchange_type

## üéØ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ ExchangeTabs
**–§–∞–π–ª:** `frontend/components/ExchangeTabs.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `userData` (name, telegram, city)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –≤–≤–µ—Ä—Ö—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –≤–∫–ª–∞–¥–∫–∞–º–∏
- –§–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –ì–æ—Ä–æ–¥ - dropdown —Å 3 –≥–æ—Ä–æ–¥–∞–º–∏: –ê–ª–º–∞—Ç—ã, –ê—Å—Ç–∞–Ω–∞, –®—ã–º–∫–µ–Ω—Ç

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```tsx
interface UserData {
  name: string;
  telegram: string;
  city: '–ê–ª–º–∞—Ç—ã' | '–ê—Å—Ç–∞–Ω–∞' | '–®—ã–º–∫–µ–Ω—Ç';
}
```

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–∏—Ç—å PermanentTab –∏ TemporaryTab
**–§–∞–π–ª—ã:** `frontend/components/PermanentTab.tsx`, `frontend/components/TemporaryTab.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏–Ω—è—Ç—å `userData` –∫–∞–∫ prop
- –ü–µ—Ä–µ–¥–∞—Ç—å `userData` –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—ã –≤ `onSubmit`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `locations` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Å –æ–¥–Ω–∏–º –≥–æ—Ä–æ–¥–æ–º

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–∏—Ç—å transformFormDataToApiFormat
**–§–∞–π–ª:** `frontend/components/ExchangeTabs.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `userData` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å `locations: [userData.city]` –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ–±—ä–µ–∫—Ç
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `exchange_type` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (permanent/temporary)

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–∏—Ç—å App.jsx
**–§–∞–π–ª:** `frontend/App.jsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–¥–∞–ª–∏—Ç—å –∏–º–ø–æ—Ä—Ç `RegistrationForm`
- –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç `ExchangeTabs`
- –ó–∞–º–µ–Ω–∏—Ç—å `RegistrationForm` –Ω–∞ `ExchangeTabs`
- –£–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —Å –ø—Ä–æ—Å—Ç—ã–º–∏ wants/offers
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 5: –û–±–Ω–æ–≤–∏—Ç—å backend –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–§–∞–π–ª:** `backend/api/endpoints/listings_exchange.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ listing –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è User —Å:
  - `username` = userData.name
  - `telegram_username` = userData.telegram (–µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @)
  - `telegram_id` = userData.telegram (–µ—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ)
  - `locations` = [userData.city]

### –≠—Ç–∞–ø 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å matching
**–§–∞–π–ª:** `backend/api/endpoints/listings_exchange.py`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `/api/listings/find-matches/{user_id}?exchange_type=permanent` —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
- `/api/listings/find-matches/{user_id}?exchange_type=temporary` —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
- Permanent matching –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç temporary —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –®–∞–≥ 1: ExchangeTabs.tsx - –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```tsx
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 163
const [userData, setUserData] = useState<UserData>({
  name: '',
  telegram: '',
  city: '–ê–ª–º–∞—Ç—ã'
});

// –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ handleSubmit
if (!userData.name.trim() || !userData.telegram.trim()) {
  setError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ —Ç–µ–ª–µ–≥—Ä–∞–º –∫–æ–Ω—Ç–∞–∫—Ç');
  return;
}
```

### –®–∞–≥ 2: PermanentTab.tsx - –ø–µ—Ä–µ–¥–∞—Ç—å userData
```tsx
interface PermanentTabProps {
  userId: number;
  userData: UserData; // –î–æ–±–∞–≤–∏—Ç—å
  onSubmit: (data: { wants: ..., offers: ..., userData: UserData }) => void;
}
```

### –®–∞–≥ 3: App.jsx - –∑–∞–º–µ–Ω–∏—Ç—å RegistrationForm
```tsx
// –£–¥–∞–ª–∏—Ç—å
import RegistrationForm from './components/RegistrationForm';

// –î–æ–±–∞–≤–∏—Ç—å
import ExchangeTabs from './components/ExchangeTabs';

// –ó–∞–º–µ–Ω–∏—Ç—å —Ä–µ–Ω–¥–µ—Ä
{showRegistration && (
  <ExchangeTabs userId={1} onMatchesFound={handleMatchesFound} />
)}
```

### –®–∞–≥ 4: Backend - –æ–±–Ω–æ–≤–∏—Ç—å User –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ listing
```python
# –í create_listing_by_categories –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 82
if user_data := listing.user_data:  # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
    user.username = user_data.get('name')
    user.locations = [user_data.get('city')]
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å telegram
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ñ–æ—Ä–º—É —Å –§–ò–û, —Ç–µ–ª–µ–≥—Ä–∞–º, –≥–æ—Ä–æ–¥ –≤–≤–µ—Ä—Ö—É
2. ‚úÖ –í—ã–±–æ—Ä –º–µ–∂–¥—É Permanent/Temporary —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫–∏
3. ‚úÖ –ö–∞–∂–¥–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
4. ‚úÖ –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è listing —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º exchange_type
5. ‚úÖ Matching —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
6. ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ User –º–æ–¥–µ–ª—å
7. ‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è listing –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

## üîÑ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–®–∞–≥ 1-3:** –û–±–Ω–æ–≤–∏—Ç—å ExchangeTabs, PermanentTab, TemporaryTab
2. **–®–∞–≥ 4:** –û–±–Ω–æ–≤–∏—Ç—å App.jsx
3. **–®–∞–≥ 5:** –û–±–Ω–æ–≤–∏—Ç—å backend –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è userData
4. **–®–∞–≥ 6:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ matching

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í—ã–±—Ä–∞—Ç—å Permanent tab, –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
3. –í—ã–±—Ä–∞—Ç—å Temporary tab, –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–∑–¥–∞–ª–∏—Å—å 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö listing —Å —Ä–∞–∑–Ω—ã–º–∏ exchange_type
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ matching –¥–ª—è permanent –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç temporary
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

