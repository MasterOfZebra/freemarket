# ๐ ะญัะฐะฟั 2-3: ML-ะฐะดะฐะฟัะธะฒะฝัะน ะธ ัะตะผะฐะฝัะธัะตัะบะธะน matching

## ๐ ะะฝะฐะปะธะท ัะปะฐะฑัั ะผะตัั ะฟะพัะปะต ะญัะฐะฟะฐ 1

### โ๏ธ 1. ะกัะฐัะธัะฝะพััั ัะธััะตะผั (ัััะฝัะต ะฒะตัะฐ)

**ะัะพะฑะปะตะผะฐ:**
- `category_weight` ะธ `contextual_bonus` ะทะฐัะธะบัะธัะพะฒะฐะฝั
- ะะพะทะผะพะถะตะฝ overfitting ะฝะฐ ัะตะบััะตะผ ะฝะฐะฑะพัะต ะบะฐัะตะณะพัะธะน
- ะะต ะฐะดะฐะฟัะธััะตััั ะฟะพะด ะฝะพะฒัะต ะดะฐะฝะฝัะต

**ะะตัะตะฝะธะต:** ะะฑััะฐะตะผะฐั ะผะพะดะตะปั (Logistic Regression / LightGBM)

---

### โ๏ธ 2. ะะพััะพะปะพะณะธั ะฑะตะท ัะตะผะฐะฝัะธะบะธ

**ะัะพะฑะปะตะผะฐ:**
- pymorphy2 ัะตัะฐะตั ัะพัะผั, ะฝะพ ะฝะต ัะผััะป
- ะัะธะผะตั: "ะฟัะปะตัะพั" vs "ัะพะฑะพั-ะฟัะปะตัะพั" โ ัะฐะทะฝัะต, ะฝะพ ะฑะปะธะทะบะธะต ะฟะพ ัะผััะปั

**ะะตัะตะฝะธะต:** Sentence embeddings ะดะปั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ััะพะดััะฒะฐ

---

### โ๏ธ 3. ะะพะฝัะตะบััะฝัะต ะบะปััะธ ะพะณัะฐะฝะธัะตะฝั

**ะัะพะฑะปะตะผะฐ:**
- ะะต ัะฐะทะปะธัะฐัั "ะดะพะฟะพะปะฝะธัะตะปัะฝัะต" ะธ "ะพะฟัะตะดะตะปัััะธะต" ัะปะพะฒะฐ
- "ัะตัะพะป ะดะปั ะฐะนัะพะฝะฐ" vs "ะฐะนัะพะฝ" ะธะผะตัั ะฟะตัะตัะตัะตะฝะธะต, ะฝะพ ะบะพะฝัะตะบัั ัะฐะทะปะธัะตะฝ

**ะะตัะตะฝะธะต:** ะะพะฝัะตะบััะฝะฐั ัะธะปัััะฐัะธั + semantic embeddings

---

### โ๏ธ 4. ะััััััะฒะธะต ะฐะดะฐะฟัะฐัะธะธ ะบ ะบะฐัะตะณะพัะธัะผ

**ะัะพะฑะปะตะผะฐ:**
- ะะตัะฐ ะบะฐัะตะณะพัะธะน ััะฐัะธัะฝั
- "ะฑะฐะนะบ" = "ะฒะตะปะพัะธะฟะตะด" ะฒ "ัะฟะพััะต", ะฝะพ ะฝะต ะฒ "ะผะพัะพัะตัะฝะธะบะต"

**ะะตัะตะฝะธะต:** Category-specific synonym maps + feedback loop

---

### โ๏ธ 5. ะกะฑะพั ะดะฐะฝะฝัั ะฑะตะท ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**ะัะพะฑะปะตะผะฐ:**
- `TrainingDataCollector` ัะพะฑะธัะฐะตั ะดะฐะฝะฝัะต, ะฝะพ ะฝะตั ML-ะผะพะดะตะปะธ
- ะะตะบัะพัะธะทะฐัะธั ะฟัะธะทะฝะฐะบะพะฒ ะฝะต ะธัะฟะพะปัะทัะตััั

**ะะตัะตะฝะธะต:** Pipeline ะพะฑััะตะฝะธั ะธ ะฟัะตะดัะบะฐะทะฐะฝะธั

---

### โ๏ธ 6. ะะตั ะผะตััะธะบะธ ะบะฐัะตััะฒะฐ ะฝะฐ ะฟัะพะดะต

**ะัะพะฑะปะตะผะฐ:**
- ะะตััะธะบะธ ัะพะปัะบะพ ะธะท ัะตััะพะฒ
- ะะตั real-world feedback loop

**ะะตัะตะฝะธะต:** Runtime ััะฐัะธััะธะบะฐ + ัะตะณัะปััะฝัะต ะพััััั

---

## ๐ค ะญัะฐะฟ 2 โ ML-matching (ะฐะดะฐะฟัะธะฒะฝะพะต ะพะฑััะตะฝะธะต)

**ะฆะตะปั:** ะะตัะตะนัะธ ะพั ัะธะบัะธัะพะฒะฐะฝะฝัั ะฒะตัะพะฒ ะบ ะพะฑััะฐะตะผะพะน ะผะพะดะตะปะธ.

**ะกัะพะบ:** 2-3 ะฝะตะดะตะปะธ

**ะะฐะทะฐ:** ะะฐะฝะฝัะต ะธะท `TrainingDataCollector` (100+ ะฟะฐั)

---

### ๐ฆ ะะพะฒัะต ะบะพะผะฟะพะฝะตะฝัั

| ะะพะดัะปั | ะะฐะทะฝะฐัะตะฝะธะต | ะกัะฐััั |
|--------|-----------|--------|
| `backend/matching/train_model.py` | ะะฑััะตะฝะธะต Logistic Regression / LightGBM | ๐ ะะปะฐะฝ |
| `backend/matching/model_predictor.py` | ะัะตะดัะบะฐะทะฐะฝะธะต ะฒะตัะพััะฝะพััะธ ัะพะฒะฟะฐะดะตะฝะธั | ๐ ะะปะฐะฝ |
| `backend/matching/feedback_manager.py` | ะกะฑะพั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะฟะพะดัะฒะตัะถะดะตะฝะธะน | ๐ ะะปะฐะฝ |
| `backend/matching/threshold_tuner.py` | ะะฟัะธะผะธะทะฐัะธั ะฟะพัะพะณะฐ ะฟะพ F1-score | ๐ ะะปะฐะฝ |

---

### โ๏ธ ะััะธัะตะบัััะฐ ะฟะฐะนะฟะปะฐะนะฝะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  TrainingDataCollector   โ  โ ัะพะฑะธัะฐะตั ะฟะฐัั match/no_match
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโ
               โ
โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
โ     FeatureCalculator       โ  โ ะณะตะฝะตัะธััะตั 8 ะฟัะธะทะฝะฐะบะพะฒ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
               โ
โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
โ       TrainModel.py         โ  โ Logistic Regression / LightGBM
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
               โ
โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
โ     ModelPredictor.py       โ  โ ะฟัะพะณะฝะพะท match-probability
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ๐ฌ ะะตะบัะพั ะฟัะธะทะฝะฐะบะพะฒ (8 ะฟัะธะทะฝะฐะบะพะฒ)

| ะัะธะทะฝะฐะบ | ะะฟะธัะฐะฝะธะต | ะะธะฐะฟะฐะทะพะฝ |
|---------|----------|----------|
| `equivalence_score` | Rule-based ัะบะฒะธะฒะฐะปะตะฝัะฝะพััั | 0.0-1.0 |
| `language_similarity` | ะฏะทัะบะพะฒะพะต ััะพะดััะฒะพ | 0.0-1.0 |
| `category_match` | ะกะพะฒะฟะฐะดะตะฝะธะต ะบะฐัะตะณะพัะธะน | 0.1-1.0 |
| `synonym_ratio` | ะะพะปั ัะธะฝะพะฝะธะผะธัะฝัั ัะปะพะฒ | 0.0-1.0 |
| `word_order_penalty` | ะจััะฐั ะทะฐ ะฟะพััะดะพะบ ัะปะพะฒ | 0.0-0.5 |
| `contextual_bonus` | ะะพะฝัั ะบะพะฝัะตะบััะฐ | 0.0-0.1 |
| `word_overlap` | Jaccard similarity | 0.0-1.0 |
| `text_length_diff` | ะะฐะทะฝะธัะฐ ะดะปะธะฝ ัะตะบััะพะฒ | 0.0-1.0 |

---

### ๐ ะะธะฝะธ-ะฟะปะฐะฝ ะฟะพ ะทะฐะดะฐัะฐะผ (2-3 ะฝะตะดะตะปะธ)

| โ | ะะพะดะทะฐะดะฐัะฐ | ะะฟะธัะฐะฝะธะต | ะะตะทัะปััะฐั | ะกัะฐััั |
|---|-----------|----------|-----------|--------|
| 1๏ธโฃ | Data preprocessing | ะกะฑะพั โฅ 100 ัะฐะทะผะตัะตะฝะฝัั ะฟะฐั | CSV ะดะปั ะพะฑััะตะฝะธั | ๐ ะะปะฐะฝ |
| 2๏ธโฃ | Train logistic model | Scikit-learn, 8 ะฟัะธะทะฝะฐะบะพะฒ | `model.pkl` | ๐ ะะปะฐะฝ |
| 3๏ธโฃ | Integrate predictor | EnhancedRuleBasedMatcher ะฒัะทัะฒะฐะตั `model.predict()` | Score ะฐะดะฐะฟัะธะฒะตะฝ | ๐ ะะปะฐะฝ |
| 4๏ธโฃ | Threshold tuning | ะะฟัะธะผะธะทะฐัะธั ะฟะพัะพะณะฐ ะฟะพ F1-score | `auto-threshold` | ๐ ะะปะฐะฝ |
| 5๏ธโฃ | Feedback loop | ะกะพััะฐะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ user feedback ะฒ JSONL | ะะตะฟัะตััะฒะฝะพะต ัะปัััะตะฝะธะต | ๐ ะะปะฐะฝ |
| 6๏ธโฃ | Auto retrain | Cron/periodic retrain ะบะฐะถะดัะต 30 ะดะฝะตะน | ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะผะพะดะตะปะธ | ๐ ะะปะฐะฝ |

---

## ๐ง ะญัะฐะฟ 3 โ ะกะตะผะฐะฝัะธัะตัะบะธะน matching (full ML)

**ะฆะตะปั:** ะะพะฝะธะผะฐัั ัะผััะป ััะฐะท, ะฐ ะฝะต ัะพะปัะบะพ ัะปะพะฒะฐ.

**ะกัะพะบ:** 3-4 ะฝะตะดะตะปะธ ะฟะพัะปะต ััะฐะฑะธะปะธะทะฐัะธะธ ะญัะฐะฟะฐ 2

**ะะฝััััะผะตะฝัั:** SentenceTransformers, FAISS, HuggingFace

---

### ๐ฆ ะะพะฒัะต ะบะพะผะฟะพะฝะตะฝัั

| ะะพะดัะปั | ะะฐะทะฝะฐัะตะฝะธะต | ะกัะฐััั |
|--------|-----------|--------|
| `backend/matching/semantic_index.py` | FAISS ะธะฝะดะตะบั ะดะปั embeddings | ๐ ะะปะฐะฝ |
| `backend/matching/embedding_service.py` | ะะตะฝะตัะฐัะธั sentence embeddings | ๐ ะะปะฐะฝ |
| `backend/matching/ensemble_scorer.py` | ะะพะผะฑะธะฝะธัะพะฒะฐะฝะธะต rule-based + ML + semantic | ๐ ะะปะฐะฝ |
| `backend/matching/contrastive_trainer.py` | Fine-tuning ะผะพะดะตะปะธ ะฝะฐ ะฟะฐัะฐั | ๐ ะะปะฐะฝ |

---

### ๐ ะัะพะณะพะฒะพะต ะฝะฐะฟัะฐะฒะปะตะฝะธะต

| ะญัะฐะฟ | ะฆะตะปั | ะัะธัะพัั | ะกัะฐััั |
|------|------|---------|--------|
| โ **ะญัะฐะฟ 1** | Rule-based ัะดัะพ, ะผะพััะพะปะพะณะธั, ะบะพะฝัะตะบัั, ะบะฐัะตะณะพัะธะธ | **+18-25%** | โ ะะฐะฒะตัััะฝ |
| ๐ก **ะญัะฐะฟ 2** | ML-matching (ะฐะดะฐะฟัะธะฒะฝัะต ะฒะตัะฐ, feedback) | **+30-40%** | ๐ ะะปะฐะฝ |
| ๐ต **ะญัะฐะฟ 3** | ะกะตะผะฐะฝัะธัะตัะบะธะน ัะปะพะน, embeddings, ะฐะฒัะพะพะฑััะตะฝะธะต | **+10-15%** | ๐ ะะปะฐะฝ |

**ะัะพะณะพะฒะฐั ัะตะปั:** ~94-96% ัะพัะฝะพััั, ~90% recall, <3% ะปะพะถะฝัั ัะพะฒะฟะฐะดะตะฝะธะน

